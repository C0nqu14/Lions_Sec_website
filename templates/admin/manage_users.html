{% extends "base.html" %}
{% block title %}Gerenciar Usuários{% endblock %}
{% block content %}

<div class="py-5">
    
    <h1 class="page-title mb-4">
        <span class="highlight-red">//</span> GESTÃO DE USUÁRIOS (ADMIN)
    </h1>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <p class="text-muted mb-0">Listagem de todos os usuários (exceto o Administrador logado).</p>
        <a href="{{ url_for('create_professor') }}" class="btn btn-info btn-sm">
            <i class="fas fa-user-plus me-1"></i> Criar Conta de Professor
        </a>
    </div>

    <form method="GET" action="{{ url_for('manage_users') }}" class="mb-4">
        <div class="row g-3 align-items-center">
            
            <div class="col-md-5">
                <input type="text" name="search" class="form-control" placeholder="Pesquisar por Nome ou Email..." value="{{ current_search }}">
            </div>

            <div class="col-md-5">
                <div class="btn-group w-100" role="group">
                    {% set filters = [('all', 'Todos'), ('aluno', 'Alunos'), ('professor', 'Professores')] %}
                    {% for value, label in filters %}
                        <a href="{{ url_for('manage_users', user_type=value, search=current_search) }}" 
                           class="btn btn-sm {% if current_filter == value %}btn-red{% else %}btn-outline-red{% endif %}"
                           aria-current="{% if current_filter == value %}true{% endif %}">
                           {{ label }}
                        </a>
                    {% endfor %}
                </div>
            </div>

            <div class="col-md-2">
                {% if current_search or current_filter != 'all' %}
                    <a href="{{ url_for('manage_users') }}" class="btn btn-outline-secondary btn-sm w-100">
                         <i class="fas fa-undo"></i> Resetar Filtros
                    </a>
                {% else %}
                    <button type="submit" class="btn btn-primary btn-sm w-100">
                        <i class="fas fa-search"></i> Pesquisar
                    </button>
                {% endif %}
            </div>
            
        </div>
    </form>
    
    <div class="card p-3">
        {% if users %}
        <div class="table-responsive">
            <table class="table table-dark table-hover mb-0">
                <thead>
                    <tr class="highlight-green-border">
                        <th class="py-2" style="width: 5%;">ID</th>
                        <th class="py-2" style="width: 25%;">Nome</th>
                        <th class="py-2" style="width: 30%;">Email</th>
                        <th class="py-2" style="width: 15%;">Tipo</th>
                        <th class="py-2" style="width: 25%;">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td class="py-3">{{ user.id }}</td>
                        <td class="py-3 fw-bold">{{ user.username }}</td>
                        <td class="py-3 text-muted">{{ user.email }}</td>
                        <td class="py-3">
                            {% if user.user_type == 'admin' %}
                                <span class="badge bg-danger">ADMIN</span>
                            {% elif user.user_type == 'professor' %}
                                <span class="badge bg-warning text-dark">PROFESSOR</span>
                            {% else %}
                                <span class="badge bg-primary">ALUNO</span>
                            {% endif %}
                        </td>
                        <td class="py-3">
                            {% if user.user_type != 'admin' %}
                            <form method="POST" action="{{ url_for('delete_user', user_id=user.id) }}" style="display:inline;">
                                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('ATENÇÃO: Tem certeza que deseja deletar o usuário {{ user.username }}? Todas as suas inscrições e scores serão perdidos.')">
                                    <i class="fas fa-trash-alt"></i> Deletar
                                </button>
                            </form>
                            {% else %}
                            <span class="text-muted small">Gerenciamento Restrito</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <div class="alert alert-info text-center mb-0" role="alert">
                <i class="fas fa-users-slash me-2"></i> Não há usuários correspondentes aos filtros.
                {% if current_search or current_filter != 'all' %}
                    <a href="{{ url_for('manage_users') }}" class="alert-link ms-2">Limpar Filtros</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}